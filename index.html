<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Sage üßô‚Äç‚ôÇÔ∏è - AI Code Assistant</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React and Babel for a modern frontend -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Marked library to render Markdown from AI response -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- React Syntax Highlighter for beautiful code rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-syntax-highlighter/15.5.0/prism.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/react-syntax-highlighter/15.5.0/styles/prism/vsc-dark-plus.min.css">

    <!-- Custom Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap"
        rel="stylesheet">

    <style>
        /* Custom styles to enhance the look and feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #f0f0f0;
        }

        .fira-code {
            font-family: 'Fira Code', monospace;
        }

        /* Custom scrollbar for a more modern look */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6a6a6a;
        }

        /* Style for the output panel */
        .output-panel pre {
            background-color: #1e1e1e !important;
            border-radius: 0.5rem;
            padding: 1rem !important;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-panel code {
            font-family: 'Fira Code', monospace;
        }

        .output-panel h1,
        .output-panel h2,
        .output-panel h3 {
            border-bottom: 1px solid #3a3a3a;
            padding-bottom: 0.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .output-panel ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }

        .output-panel li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const SyntaxHighlighter = window.Prism;

        // --- Main Application Component ---
        function App() {
            // --- STATE MANAGEMENT ---
            const [code, setCode] = useState(
                `def factorial(n):
    # A simple function to calculate factorial
    # but it has a bug for n=0
    if n < 0:
        return "Not defined for negative numbers"
    result = 1
    for i in range(1, n + 1):
        result *= i
    return result

print(factorial(5))
print(factorial(0)) # Bug: Should be 1, but returns 1`
            );
            const [language, setLanguage] = useState('python');
            const [translateTo, setTranslateTo] = useState('javascript');
            const [output, setOutput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [activeAction, setActiveAction] = useState(null);

            // --- WELCOME MESSAGE ---
            useEffect(() => {
                setOutput(`
# Welcome to Code Sage üßô‚Äç‚ôÇÔ∏è

I am your AI-powered code assistant. Here's how I can help you:

1.  **Paste your code** in the editor on the left.
2.  **Select the code's language** from the dropdown menu.
3.  **Choose an action** from the panel below to analyze, improve, or transform your code.

Let's make some great code together!
                `);
            }, []);

            // --- PROMPT ENGINEERING ---
            const createPrompt = (action, codeSnippet, lang, targetLang) => {
                const systemPrompt = "You are Code Sage, an expert AI programming assistant with deep knowledge across multiple programming languages and software engineering best practices. Your responses should be clear, concise, and formatted in Markdown.";

                const actionPrompts = {
                    'find-bugs': `
                        ${systemPrompt}
                        Your task is to act as an expert code reviewer and security auditor.
                        Analyze the following ${lang} code snippet for bugs, logical errors, and potential security vulnerabilities.
                        For each issue you find, provide:
                        1. A clear title for the issue (e.g., "Logic Error: Incorrect Loop Boundary").
                        2. The line number(s) of the problematic code.
                        3. A detailed but easy-to-understand explanation of why it's a problem.
                        4. A code snippet showing the suggested fix.
                        If no bugs are found, state that clearly.
                        ---
                        CODE:
                        \`\`\`${lang}
                        ${codeSnippet}
                        \`\`\`
                    `,
                    'refactor': `
                        ${systemPrompt}
                        Your task is to act as a senior software engineer specializing in code optimization and readability.
                        Refactor the following ${lang} code snippet to improve its efficiency, readability, and adherence to modern best practices and idiomatic conventions for ${lang}.
                        Provide the refactored code first, then provide a brief, clear explanation of the key changes you made and why they are improvements.
                        ---
                        ORIGINAL CODE:
                        \`\`\`${lang}
                        ${codeSnippet}
                        \`\`\`
                    `,
                    'generate-tests': `
                        ${systemPrompt}
                        Your task is to act as a Quality Assurance engineer specializing in Test-Driven Development (TDD).
                        Generate a suite of unit tests for the following ${lang} code snippet.
                        Use a popular testing framework suitable for ${lang} (e.g., Pytest for Python, Jest for JavaScript/TypeScript, JUnit for Java).
                        The tests should cover edge cases, common scenarios, and potential failure points.
                        Provide the complete, runnable test code, and add comments explaining what each test case is verifying.
                        ---
                        CODE TO TEST:
                        \`\`\`${lang}
                        ${codeSnippet}
                        \`\`\`
                    `,
                    'document': `
                        ${systemPrompt}
                        Your task is to act as a technical writer creating developer documentation.
                        Generate clear, concise documentation for the following ${lang} code snippet.
                        The documentation should explain the function's purpose, its parameters (including their types and descriptions), and what it returns.
                        Use a standard documentation format appropriate for the language (e.g., JSDoc for JavaScript, Python Docstrings for Python, JavaDoc for Java).
                        ---
                        CODE TO DOCUMENT:
                        \`\`\`${lang}
                        ${codeSnippet}
                        \`\`\`
                    `,
                    'translate': `
                        ${systemPrompt}
                        Your task is to act as a polyglot programmer, an expert in translating code between languages.
                        Translate the following ${lang} code snippet into ${targetLang}.
                        Ensure the translated code is idiomatic and follows the best practices of ${targetLang}.
                        Provide the translated code first. Then, add a section with notes explaining any key differences or idiomatic changes made during the translation.
                        ---
                        ORIGINAL CODE (${lang}):
                        \`\`\`${lang}
                        ${codeSnippet}
                        \`\`\`
                    `
                };
                return actionPrompts[action];
            };


            // --- API CALL HANDLER ---
            const handleApiCall = async (action) => {
                // --- API KEY CONFIGURATION ---
                // IMPORTANT: PASTE YOUR GEMINI API KEY HERE
                // Get your free key from Google AI Studio: https://aistudio.google.com/app/apikey
                const apiKey = "AIzaSyDt-Lqz9rTLmqOSjoarwbr8UgYCofyrMSI";

                // Check if the API key is missing.
                if (apiKey === "PASTE_YOUR_API_KEY_HERE" || !apiKey) {
                    setError("Please add your Gemini API key inside the script tag in the HTML file.");
                    return;
                }

                if (!code.trim()) {
                    setError("Please enter some code to analyze.");
                    return;
                }

                setIsLoading(true);
                setError(null);
                setActiveAction(action);
                setOutput(''); // Clear previous output

                const prompt = createPrompt(action, code, language, translateTo);

                try {
                    // This function calls the Gemini API with exponential backoff for resilience.
                    const callWithBackoff = async (retries = 3, delay = 1000) => {
                        try {
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                            const payload = {
                                contents: [{ role: "user", parts: [{ text: prompt }] }]
                            };

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });

                            if (!response.ok) {
                                // Provide a more specific error message for 4xx/5xx errors
                                const errorBody = await response.json();
                                const errorMessage = errorBody?.error?.message || `API Error: ${response.statusText} (Status: ${response.status})`;
                                throw new Error(errorMessage);
                            }

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                                return result.candidates[0].content.parts[0].text;
                            } else {
                                // Handle cases where the response structure is unexpected or content is blocked
                                const finishReason = result?.candidates?.[0]?.finishReason;
                                if (finishReason === 'SAFETY') {
                                    throw new Error("Response was blocked due to safety settings. Try modifying your code or prompt.");
                                }
                                throw new Error("Invalid response structure from AI.");
                            }
                        } catch (error) {
                            if (retries > 0) {
                                console.log(`Retrying in ${delay}ms... (${retries} retries left)`);
                                await new Promise(res => setTimeout(res, delay));
                                return callWithBackoff(retries - 1, delay * 2);
                            } else {
                                throw error;
                            }
                        }
                    };

                    const resultText = await callWithBackoff();
                    setOutput(resultText);

                } catch (err) {
                    console.error(err);
                    setError(`An error occurred: ${err.message}`);
                    setOutput(''); // Clear output on error
                } finally {
                    setIsLoading(false);
                    setActiveAction(null);
                }
            };

            // --- RENDERED OUTPUT ---
            const renderedOutput = useMemo(() => {
                return { __html: marked.parse(output || '') };
            }, [output]);

            // --- UI COMPONENTS ---
            const ActionButton = ({ action, children, icon }) => (
                <button
                    onClick={() => handleApiCall(action)}
                    disabled={isLoading}
                    className={`
                        flex-1 flex items-center justify-center px-4 py-3 text-sm font-semibold rounded-md transition-all duration-200
                        focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900
                        ${isLoading ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-gray-700 hover:bg-gray-600 text-white focus:ring-indigo-500'}
                    `}
                >
                    {isLoading && activeAction === action ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <span className="mr-2">{icon}</span>
                    )}
                    {children}
                </button>
            );

            const LanguageSelect = ({ value, onChange, id }) => (
                <select
                    id={id}
                    value={value}
                    onChange={onChange}
                    disabled={isLoading}
                    className="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 fira-code"
                >
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="typescript">TypeScript</option>
                    <option value="java">Java</option>
                    <option value="csharp">C#</option>
                    <option value="go">Go</option>
                    <option value="rust">Rust</option>
                    <option value="html">HTML</option>
                    <option value="css">CSS</option>
                    <option value="sql">SQL</option>
                </select>
            );

            // --- MAIN RENDER ---
            return (
                <div className="min-h-screen bg-gray-900 text-gray-200 p-4 sm:p-6 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <header className="text-center mb-8">
                            <h1 className="text-4xl sm:text-5xl font-bold text-white">
                                Code Sage <span role="img" aria-label="wizard">üßô‚Äç‚ôÇÔ∏è</span>
                            </h1>
                            <p className="mt-2 text-lg text-gray-400">Your AI-Powered Pair Programmer & Code Reviewer</p>
                        </header>

                        {/* Main Grid Layout */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Left Panel: Input */}
                            <div className="flex flex-col space-y-4">
                                <div className="flex items-center justify-between">
                                    <label htmlFor="language-select" className="text-lg font-semibold">Your Code</label>
                                    <div className="w-48">
                                        <LanguageSelect id="language-select" value={language} onChange={(e) => setLanguage(e.target.value)} />
                                    </div>
                                </div>
                                <textarea
                                    value={code}
                                    onChange={(e) => setCode(e.target.value)}
                                    placeholder="Paste your code here..."
                                    className="w-full h-96 flex-grow bg-gray-800 border border-gray-600 rounded-md p-4 fira-code text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"
                                    spellCheck="false"
                                />
                            </div>

                            {/* Right Panel: Output */}
                            <div className="flex flex-col space-y-4">
                                <h2 className="text-lg font-semibold">Sage's Analysis</h2>
                                <div className="w-full h-96 flex-grow bg-gray-800 border border-gray-600 rounded-md p-4 overflow-y-auto output-panel">
                                    {isLoading && !output && (
                                        <div className="flex items-center justify-center h-full">
                                            <div className="text-center">
                                                <svg className="animate-spin mx-auto h-12 w-12 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                                <p className="mt-4 text-gray-400">The Sage is thinking...</p>
                                            </div>
                                        </div>
                                    )}
                                    {error && (
                                        <div className="flex items-center justify-center h-full">
                                            <div className="bg-red-900 border border-red-600 text-red-100 px-4 py-3 rounded-md text-center">
                                                <strong className="font-bold">Error:</strong>
                                                <span className="block sm:inline ml-2">{error}</span>
                                            </div>
                                        </div>
                                    )}
                                    {!isLoading && <div dangerouslySetInnerHTML={renderedOutput} />}
                                </div>
                            </div>
                        </div>

                        {/* Action Panel */}
                        <div className="mt-6 p-4 bg-gray-800/50 border border-gray-700 rounded-lg">
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                                <ActionButton action="find-bugs" icon="üêõ">Find Bugs</ActionButton>
                                <ActionButton action="refactor" icon="‚ú®">Refactor</ActionButton>
                                <ActionButton action="generate-tests" icon="üß™">Generate Tests</ActionButton>
                                <ActionButton action="document" icon="üìö">Document</ActionButton>

                                <div className="flex flex-col space-y-2 sm:col-span-2 lg:col-span-1">
                                    <ActionButton action="translate" icon="üåê">Translate</ActionButton>
                                    <LanguageSelect id="translate-to-select" value={translateTo} onChange={(e) => setTranslateTo(e.target.value)} />
                                </div>
                            </div>
                        </div>
                        <footer className="text-center mt-8 text-gray-500 text-sm">
                            <p>Built with React, Tailwind CSS, and the power of Generative AI.</p>
                            <p>A project to showcase modern web development and AI integration skills.</p>
                        </footer>
                    </div>
                </div>
            );
        }

        // --- Render the App to the DOM ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>


</html>
